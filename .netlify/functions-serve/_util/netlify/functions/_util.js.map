{
  "version": 3,
  "sources": ["../../../../../rxgibsmt/Dev/NexusLite/nexus-lite/netlify/functions/_util.js"],
  "sourceRoot": "C:/Users/rxgib/AppData/Local/Temp/tmp-7456-eKIDr5vQPxWl",
  "sourcesContent": ["// netlify/functions/_util.js\r\n// Shared helpers for all AI functions\r\n\r\nexport async function withTimeout(ms, run) {\r\n  const ctrl = new AbortController();\r\n  const t = setTimeout(() => ctrl.abort(), ms);\r\n  try {\r\n    return await run(ctrl.signal);\r\n  } finally {\r\n    clearTimeout(t);\r\n  }\r\n}\r\n\r\n// Standard OpenAI call (Chat Completions)\r\nexport async function callOpenAI(\r\n  { system, user, temperature = 0.35, model = \"gpt-4o-mini\" },\r\n  signal\r\n) {\r\n  const key = process.env.OPENAI_API_KEY || \"\";\r\n  if (!key) {\r\n    return {\r\n      ok: false,\r\n      status: 500,\r\n      json: { error: \"missing_api_key\", detail: \"Set OPENAI_API_KEY in Netlify env vars.\" }\r\n    };\r\n  }\r\n\r\n  const resp = await fetch(\"https://api.openai.com/v1/chat/completions\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${key}` },\r\n    body: JSON.stringify({\r\n      model,\r\n      temperature,\r\n      messages: [\r\n        { role: \"system\", content: system },\r\n        { role: \"user\", content: user }\r\n      ]\r\n    }),\r\n    signal\r\n  });\r\n\r\n  if (!resp.ok) {\r\n    const text = await resp.text().catch(() => \"\");\r\n    return { ok: false, status: 502, json: { error: \"openai_error\", status: resp.status, detail: text } };\r\n  }\r\n\r\n  const data = await resp.json();\r\n  const content = data?.choices?.[0]?.message?.content || \"No reply.\";\r\n  return { ok: true, status: 200, json: { reply: content } };\r\n}\r\n\r\n// Simple JSON body reader (since we\u2019re on Netlify functions)\r\nexport async function readJson(event) {\r\n  try {\r\n    return JSON.parse(event.body || \"{}\");\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,eAAsB,YAAY,IAAI,KAAK;AACzC,QAAM,OAAO,IAAI,gBAAgB;AACjC,QAAM,IAAI,WAAW,MAAM,KAAK,MAAM,GAAG,EAAE;AAC3C,MAAI;AACF,WAAO,MAAM,IAAI,KAAK,MAAM;AAAA,EAC9B,UAAE;AACA,iBAAa,CAAC;AAAA,EAChB;AACF;AAGA,eAAsB,WACpB,EAAE,QAAQ,MAAM,cAAc,MAAM,QAAQ,cAAc,GAC1D,QACA;AACA,QAAM,MAAM,QAAQ,IAAI,kBAAkB;AAC1C,MAAI,CAAC,KAAK;AACR,WAAO;AAAA,MACL,IAAI;AAAA,MACJ,QAAQ;AAAA,MACR,MAAM,EAAE,OAAO,mBAAmB,QAAQ,0CAA0C;AAAA,IACtF;AAAA,EACF;AAEA,QAAM,OAAO,MAAM,MAAM,8CAA8C;AAAA,IACrE,QAAQ;AAAA,IACR,SAAS,EAAE,gBAAgB,oBAAoB,eAAe,UAAU,GAAG,GAAG;AAAA,IAC9E,MAAM,KAAK,UAAU;AAAA,MACnB;AAAA,MACA;AAAA,MACA,UAAU;AAAA,QACR,EAAE,MAAM,UAAU,SAAS,OAAO;AAAA,QAClC,EAAE,MAAM,QAAQ,SAAS,KAAK;AAAA,MAChC;AAAA,IACF,CAAC;AAAA,IACD;AAAA,EACF,CAAC;AAED,MAAI,CAAC,KAAK,IAAI;AACZ,UAAM,OAAO,MAAM,KAAK,KAAK,EAAE,MAAM,MAAM,EAAE;AAC7C,WAAO,EAAE,IAAI,OAAO,QAAQ,KAAK,MAAM,EAAE,OAAO,gBAAgB,QAAQ,KAAK,QAAQ,QAAQ,KAAK,EAAE;AAAA,EACtG;AAEA,QAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,QAAM,UAAU,MAAM,UAAU,CAAC,GAAG,SAAS,WAAW;AACxD,SAAO,EAAE,IAAI,MAAM,QAAQ,KAAK,MAAM,EAAE,OAAO,QAAQ,EAAE;AAC3D;AAGA,eAAsB,SAAS,OAAO;AACpC,MAAI;AACF,WAAO,KAAK,MAAM,MAAM,QAAQ,IAAI;AAAA,EACtC,QAAQ;AACN,WAAO,CAAC;AAAA,EACV;AACF;",
  "names": []
}
